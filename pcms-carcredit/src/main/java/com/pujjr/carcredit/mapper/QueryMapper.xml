<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pujjr.carcredit.dao.QueryMapper">
	<select id="selectApplyList" resultType="HashMap">
		select 
		apply.APP_ID as appId,
		product.PRODUCT_NAME as  productName,
		sign.CONTRACT_NO as contractNo,
		tenant.NAME as name,
		tenant.ID_NO as idNo,
		apply.CREATE_TIME as createTime,
		apply.STATUS as status,
		branch.BRANCH_NAME as branchName,
		task.NAME_ as taskName,
		account.ACCOUNT_NAME  as assignee,
		apply.APPROVE_DATE as approveDate,
		apply.TOTAL_FINANCE_AMT as totalFinanceAmt,
		apply.PERIOD as period
		
		from T_APPLY apply
		left join T_APPLY_TENANT tenant on apply.APP_ID = tenant.APP_ID
		left join T_PRODUCT product on apply.PRODUCT_CODE = product.PRODUCT_CODE
		left join SYS_BRANCH branch on apply.CREATE_BRANCH_CODE = branch.BRANCH_CODE
		left join T_SIGN_CONTRACT sign on apply.APP_ID = sign.APP_ID
		left join act_ru_task task on apply.PROC_INST_ID = task.PROC_INST_ID_
		left join SYS_ACCOUNT account on task.ASSIGNEE_ = account.ACCOUNT_ID 
		where 1=1 
		<if test="param.appId!=null and param.appId!=''">
			and apply.APP_ID like CONCAT('%',CONCAT(#{param.appId},'%'))
		</if>
	</select>
	<select id="selectApplyConditionLoanCommentList" resultType="HashMap">
		select 
		c.PROCESS_RESULT_DESC as processResultDesc,
		b.END_TIME as endTime 
		
		from t_apply a

		left join t_workflow_runpath b on a.PROC_INST_ID =  b.PROC_INST_ID

		left join t_task_process_result c on b.id = c.RUN_PATH_ID

		where c.PROCESS_RESULT in ('tjlx102','tjlx202') and a.APP_ID = #{appId}
	</select>
</mapper>